######## Grundkonfiguration ########
## Betriebsystem Update
Sudo apt update && sudo apt upgrade -y 
sudo apt autoremove

## SSH aktivieren
sudo systemctl enable SSH

########## Firewall ##########
## Firewall installieren
sudo apt install ufw -y

## Firewall konfigurieren
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow SSH
sudo ufw allow 8096

## Firewall aktivieren
sudo ufw enable
sudo ufw status

########## Systemhärtung ##########

## Autoupdates 
sudo apt install unattended-upgrades -y
sudo dpkg-reconfigure unattended-upgrades

##### SSH absichern #####

## Key einbinden
mkdir -p ~/.ssh
chmod 700 ~/.ssh
nano ~/.ssh/authorized_keys
#Key einfügen
chmod 600 ~/.ssh/authorized_keys

## Fail2Ban

# installieren 
sudo apt install fail2ban -y

# konfigurieren
sudo nano /etc/fail2ban/jail.local

## Konfiguration ##
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 5
bantime = 1h
findtime = 10m
###################

# Dienst starten und aktivieren 
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

## SSH Einstellungen
# Konifgurationsdatei öffenen 
sudo nano /etc/ssh/sshd_config

## Konfiguration ##
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
MaxAuthTries 3
LoginGraceTime 30
###################

########## Jellyfin Installation ###########

##### Vorbereitungen #####

## System aktualisieren
sudo apt update && sudo apt upgrade -y
sudo apt autoremove -y

## Pakete installieren
sudo apt install -y curl apt-transport-https gnupg lsb-release ca-certificates software-properties-common cifs-utils

##### Share Mounten #####

## Mount-Punkt erstellen
sudo mkdir -p /mnt/media

## Credential-Datei anlegen
sudo nano /root/.smbcredentials
## Inhalt ##
username=TH\svc-jellyfin
password="***********"
domain=TH
############

## Datei schützen
sudo chmod 600 /root/.smbcredentials

## Automatisches Mounten beim Boot
sudo nano /etc/fstab
## Ihnalt ##
//192.168.178.204/Jellyfin_Media /mnt/media cifs credentials=/root/.smbcredentials,iocharset=utf8,vers=3.1.1,sec=ntlmssp,_netdev 0 0
############

##### GPU einbinden #####

## NVIDIA-Treiber installieren
sudo apt install -y nvidia-driver-535

##### Jellyfin installieren #####

## Installation-Skript herunterladen und ausführen
curl https://repo.jellyfin.org/install-debuntu.sh | sudo bash





